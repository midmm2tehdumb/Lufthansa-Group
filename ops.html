<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Operations | Lufthansa GeoFS</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>

    <nav class="main-nav" id="navbar">
        <div class="nav-wrapper">
            <div class="nav-left">
                <a href="index.html" class="logo-link">
                    <img src="logo.png" alt="Logo" class="nav-logo">
                    <span>Lufthansa GeoFS</span>
                </a>
            </div>
            <ul class="nav-links">
                <li class="pillar-link" onclick="toggleMenu('ops-menu')">Flight Operations</li>
                <li class="pillar-link" onclick="toggleMenu('network-menu')">Live Network</li>
                <li class="pillar-link" onclick="toggleMenu('media-news')">Media & News</li>
                <li class="pillar-link" onclick="toggleMenu('crew-menu')">Crew & Community</li>
            </ul>
            <div class="hamburger" onclick="toggleMobileMenu()">
                <div class="bar"></div><div class="bar"></div><div class="bar"></div>
            </div>
        </div>
        <div class="mega-overlay" id="menu-overlay" onclick="closeAllMenus()"></div>
        <div id="ops-menu" class="mega-panel">
            <div class="panel-content">
                <div class="menu-col"><h3>Ops Center</h3><a href="ops.html">Flight Dispatch</a><a href="livery-db.html">Livery Database</a></div>
                <div class="menu-col"><h3>Fleet</h3><a href="fleet.html">Main Fleet</a><a href="sop-manuals.html">SOP & Manuals</a></div>
            </div>
        </div>
        <div id="network-menu" class="mega-panel">
            <div class="panel-content">
                <div class="menu-col"><h3>Network Hub</h3><a href="network.html">Route Map</a><a href="radar.html">Live Radar</a></div>
                <div class="menu-col"><h3>Hubs</h3><a href="hub-info.html#fra">Frankfurt (FRA)</a><a href="hub-info.html#muc">Munich (MUC)</a></div>
            </div>
        </div>
        <div id="media-news" class="mega-panel">
            <div class="panel-content">
                <div class="menu-col"><h3>The Gazette</h3><a href="news.html">Latest News</a><a href="gallery.html">Fleet Gallery</a></div>
            </div>
        </div>
        <div id="crew-menu" class="mega-panel">
            <div class="panel-content">
                <div class="menu-col"><h3>The Elite</h3><a href="hall-of-fame.html">Hall of Fame</a><a href="service-medals.html">Service Medals</a></div>
                <div class="menu-col"><h3>Highlights</h3><a href="highlights.html">Our Perks</a></div>
            </div>
        </div>
    </nav>

    <main class="ops-main">
        <header class="page-title">
            <h1>Flight Operations</h1>
            <div class="title-underline"></div>
            <p>Ready for departure? Access your tools and hub conditions below.</p>
        </header>


        <section class="dispatch-tool">
    <div class="tool-container">
        <div class="tool-inputs">
            <div class="field">
                <label>Departure</label>
                <select id="departure" class="ops-select"></select>
            </div>
            <div class="field">
                <label>Arrival</label>
                <select id="arrival" class="ops-select"></select>
            </div>
            <button onclick="calculateFlight()" class="btn-calculate">Generate Flight Plan</button>
        </div>

        <div id="dispatch-results" class="dispatch-results-grid" style="display: none;">
            </div>
    </div>
</section>
        
        <div class="ops-grid">
            
            <div class="ops-card">
                <div class="card-content">
                    <h3>Frankfurt (EDDF)</h3>
                    <iframe src="https://checkwx.com/weather/EDDF/metar" width="100%" height="200" frameborder="0" style="border-radius: 8px;"></iframe>
                </div>
                <a href="https://checkwx.com/weather/EDDF/metar" target="_blank" class="btn-outline-blue">Full Weather Report</a>
            </div>

            <div class="ops-card">
                <div class="card-content">
                    <h3>Munich (EDDM)</h3>
                    <iframe src="https://checkwx.com/weather/EDDM/metar" width="100%" height="200" frameborder="0" style="border-radius: 8px;"></iframe>
                </div>
                <a href="https://checkwx.com/weather/EDDM/metar" target="_blank" class="btn-outline-blue">Full Weather Report</a>
            </div>

            <div class="ops-card">
                <div class="card-content">
                    <h3>Route Network</h3>
                    <p>View our global destinations, subsidiary hubs, and searchable airport directory.</p>
                </div>
                <a href="network.html" class="btn-outline-blue">Open Route Map</a>
            </div>

            <div class="ops-card">
                <div class="card-content">
                    <h3>Live Fleet Radar</h3>
                    <p>Real-time tracking of active Lufthansa callsigns across the GeoFS world.</p>
                </div>
                <a href="radar.html" class="btn-outline-blue">Open Live Radar</a>
            </div>

            <div class="ops-card">
                <div class="card-content">
                    <h3>Flight Planning</h3>
                    <p>Generate your Operational Flight Plan using SimBrief. Ensure you <strong>follow flight restrictions</strong> and <strong>routes</strong> for realism.</p>
                </div>
                <a href="https://www.simbrief.com/system/dispatch.php" target="_blank" class="btn-gold">Launch SimBrief</a>
            </div>

            <div class="ops-card">
                <div class="card-content">
                    <h3>Livery Database</h3>
                    <p>Access the custom livery files that our team has meticulously created for specific aircraft.</p>
                </div>
                <a href="livery-db.html" class="btn-outline-blue">View Liveries</a>
            </div>

            <div class="ops-card">
                <div class="card-content">
                    <h3>SOP & Manuals</h3>
                    <p>Detailed Standard Operating Procedures for taxi, takeoff, and GeoFS-specific navigation.</p>
                </div>
                <a href="sop-manuals.html" class="btn-outline-blue">Open Manuals</a>
            </div>

            <div class="ops-card">
                <div class="card-content">
                    <h3>Pilot Support</h3>
                    <p>Have questions regarding routes or operations? Connect with the team in the General channel.</p>
                </div>
                <a href="https://discord.com/channels/1404322265214095470/1404322265822396418" target="_blank" class="btn-outline-blue">Discord Help</a>
            </div>

        </div>
    </main>

    <script>

        // Function to handle the button click and time logic
function runDispatch() {
    const dep = document.getElementById('departure').value;
    const arr = document.getElementById('arrival').value;
    const resDiv = document.getElementById('dispatch-results');

    if(!dep || !arr || dep === arr) { alert("Select two different airports."); return; }

    const depData = airportCoords[dep];
    const arrData = airportCoords[arr];
    
    // 1. RUN PHYSICS ENGINE
    const distance = getDistance([depData[0], depData[1]], [arrData[0], arrData[1]]);
    const plane = suggestPlane(distance);
    const flightHours = estimateTime(distance, [depData[0], depData[1]], [arrData[0], arrData[1]], plane);

    // 2. TIME CALCULATIONS
    const nowUTC = new Date();
    const arrivalUTC = new Date(nowUTC.getTime() + (flightHours * 3600000));
    
    // Local Browser Times
    const userDep = nowUTC.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    const userArr = arrivalUTC.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

    // Airport Local Times (using your correction logic)
    const depLocal = formatLocalTimeWithOffset(nowUTC, depData[2]);
    const arrLocal = formatLocalTimeWithOffset(arrivalUTC, arrData[2]);

    // 3. INJECT RESULTS
    resDiv.style.display = "grid";
    resDiv.innerHTML = `
        <div class="result-card">
            <span class="res-label">Aircraft & Performance</span>
            <span class="res-data">${plane}</span>
            <span class="res-sub">ETE: ${Math.floor(flightHours)}h ${Math.round((flightHours % 1) * 60)}m</span>
        </div>
        <div class="result-card">
            <span class="res-label">Your Local Time</span>
            <span class="res-data">ðŸ›« ${userDep}</span>
            <span class="res-data">ðŸ›¬ ${userArr}</span>
        </div>
        <div class="result-card">
            <span class="res-label">Hub Local Times</span>
            <span class="res-data">ðŸ›« ${dep}: ${depLocal}</span>
            <span class="res-data">ðŸ›¬ ${arr}: ${arrLocal}</span>
        </div>
        <div class="result-card">
            <span class="res-label">Mission Data</span>
            <span class="res-data">${distance.toFixed(0)} KM</span>
            <span class="res-sub">UTC Landing: ${arrivalUTC.getUTCHours()}:${arrivalUTC.getUTCMinutes()}z</span>
        </div>
    `;
}

// Ensure your formatLocalTimeWithOffset function is included:
function formatLocalTimeWithOffset(utcDate, offsetHours) {
    const newDate = new Date(utcDate.getTime());
    newDate.setUTCHours(newDate.getUTCHours() + offsetHours);
    return newDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', timeZone: 'UTC' });
}
        
        let lastScrollY = window.scrollY;
        const navbar = document.getElementById("navbar");
        window.addEventListener("scroll", () => {
            if (window.scrollY > lastScrollY && window.scrollY > 150) {
                navbar.classList.add("nav-hidden");
                closeAllMenus(); 
            } else { navbar.classList.remove("nav-hidden"); }
            lastScrollY = window.scrollY;
        });

        function toggleMenu(menuId) {
            const menu = document.getElementById(menuId);
            const overlay = document.getElementById("menu-overlay");
            const isOpen = menu.classList.contains("active");
            closeAllMenus();
            if (!isOpen) { menu.classList.add("active"); overlay.classList.add("active"); }
        }

        function closeAllMenus() {
            document.querySelectorAll('.mega-panel').forEach(p => p.classList.remove('active'));
            document.getElementById("menu-overlay").classList.remove("active");
        }

        function toggleMobileMenu() {
            const m = document.getElementById("mobile-menu");
            m.classList.toggle("open");
            if(!m.classList.contains("open")) backToMainMobile();
            document.body.style.overflow = m.classList.contains("open") ? "hidden" : "auto";
        }

        function showSubMobile(subId) {
            document.getElementById("mobile-main-links").style.display = "none";
            document.getElementById(subId).style.display = "block";
            document.getElementById("mobile-back").style.display = "inline";
        }

        function backToMainMobile() {
            document.getElementById("mobile-main-links").style.display = "block";
            document.querySelectorAll(".mobile-sub-menu").forEach(s => s.style.display = "none");
            document.getElementById("mobile-back").style.display = "none";
        }
    </script>
</body>
</html>
